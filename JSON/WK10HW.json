{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",

  "autosize": {"type": "fit", "contains": "padding"},

  "params": [
    {
      "name": "Year",
      "value": 2022,
      "bind": {"input": "range", "min": 2011, "max": 2022, "step": 1}
    },
    {
      "name": "zoom_level",
      "value": 60000,
      "bind": {
        "input": "range",
        "min": 8000,
        "max": 100000,
        "step": 500,
        "name": "Zoom: "
      }
    }
  ],

  "hconcat": [
    {
      "title": "South Australia Crime by Suburb",
      "width": 600,
      "height": 500,
      "view": {"stroke": null},
      "projection": {
        "type": "equirectangular",
        "center": [138.4, -34.9],
        "scale": {"expr": "zoom_level"}
      },

      "layer": [
        {
          "name": "ocean-background",
          "data": {"sphere": true},
          "mark": {"type": "geoshape"},
          "encoding": {"color": {"value": "#87CEEB"}}
        },
        {
          "name": "base-grey-no-data",
          "data": {
            "url": "https://raw.githubusercontent.com/matt-b-0/FIT-3179-A2/main/JSON/Suburbs_GDA2020.geojson",
            "format": {"type": "json", "property": "features"}
          },
          "transform": [
            {"filter": "datum.properties && datum.properties.suburb"},
            {
              "calculate": "'is available in \\' ' + datum.properties.suburb + ' \\' '",
              "as": "No data"
            }
          ],
          "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.2},
          "encoding": {
            "color": {"value": "#e0e0e0"},
            "tooltip": [{"field": "No data", "type": "nominal", "title": ""}]
          }
        },
        {
          "name": "crime-colored-overlay",
          "data": {
            "url": "https://raw.githubusercontent.com/matt-b-0/FIT-3179-A2/main/JSON/Suburbs_GDA2020.geojson",
            "format": {"type": "json", "property": "features"}
          },
          "transform": [
            {"filter": "datum.properties && datum.properties.suburb"},
            {
              "lookup": "properties.suburb",
              "from": {
                "data": {
                  "url": "https://raw.githubusercontent.com/matt-b-0/FIT-3179-A2/main/Data/Week10CSV.csv"
                },
                "key": "suburb",
                "fields": ["crime_count", "year"]
              },
              "as": ["crime_count", "year"]
            },
            {"filter": "isValid(datum.crime_count) && datum.year == Year"},
            {"calculate": "datum.crime_count", "as": "crime_count_filled"}
          ],
          "mark": {"type": "geoshape", "stroke": "white", "strokeWidth": 0.2},
          "encoding": {
            "color": {
              "field": "crime_count_filled",
              "type": "quantitative",
              "title": "Number of Crimes",
              "scale": {"scheme": "reds", "domainMin": 0},
              "legend": {
                "orient": "bottom",
                "titleLimit": 200,
                "offset": 10
              }
            },
            "tooltip": [
              {"field": "properties.suburb", "type": "nominal", "title": "Suburb"},
              {
                "field": "crime_count_filled",
                "type": "quantitative",
                "title": "Number of Crimes",
                "format": ","
              },
              {"field": "year", "type": "quantitative", "title": "Year"}
            ]
          }
        }
      ]
    },

    {
      "title": "Top 5 Suburbs by Crimes (Selected Year)",
      "width": 300,
      "height": 500,
      "data": {
        "url": "https://raw.githubusercontent.com/matt-b-0/FIT-3179-A2/main/Data/Week10CSV.csv"
      },
      "transform": [
        {"filter": "datum.year == Year"},
        {"filter": "lower(datum.suburb) != 'not disclosed'"},
        {
          "aggregate": [
            {"op": "sum", "field": "crime_count", "as": "total_crimes"}
          ],
          "groupby": ["suburb"]
        },
        {
          "window": [{"op": "rank", "as": "rank"}],
          "sort": [{"field": "total_crimes", "order": "descending"}]
        },
        {"filter": "datum.rank <= 5"}
      ],
      "mark": {"type": "bar", "color": "#d73027"},
      "encoding": {
        "x": {
          "field": "total_crimes",
          "type": "quantitative",
          "title": "Total Crimes (Selected Year)"
        },
        "y": {
          "field": "suburb",
          "type": "nominal",
          "title": "Suburb",
          "sort": "-x",
          "axis": {"labelFontSize": 12}
        },
        "tooltip": [
          {"field": "suburb", "type": "nominal", "title": "Suburb"},
          {
            "field": "total_crimes",
            "type": "quantitative",
            "title": "Total Crimes (Selected Year)",
            "format": ","
          }
        ]
      }
    }
  ]
}
